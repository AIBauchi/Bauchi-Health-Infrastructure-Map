<!DOCTYPE html>
<html>
<head>
  <title>Bauchi State Map with Label</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    <!-- bootstrap 5.3 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
  </style>
  <!-- fa -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
</head>
<body>

<div id="map"></div>


<!-- The Modal -->
<div id="addModal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
            <h4 class="modal-title">Hospital Information</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <!-- Modal Body -->
        <div class="modal-body">
            <div class="row">
                <div class="col-md-6">
                    <label>Name:</label>
                    <p id="name"></p>
                </div>
                <div class="col-md-6">
                    <label>Health Facility Type:</label>
                    <p id="health_facility_type"></p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label>Operator:</label>
                    <p id="operator"></p>
                </div>
                <div class="col-md-6">
                    <label>Phone:</label>
                    <p id="phone"></p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label>Website:</label>
                    <p id="website"></p>
                </div>
                <div class="col-md-6">
                    <label>Opening Hours:</label>
                    <p id="opening_hours"></p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label>Address:</label>
                    <p id="address"></p>
                </div>
                <div class="col-md-6">
                    <label>Wheelchair:</label>
                    <p id="wheelchair"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<!-- bootstrap 5.3 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js" integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js" integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    // Initialize the map
var map = L.map('map').setView([10.28, 9.82], 7); // Centering around Bauchi

// Add OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
}).addTo(map);

// Fetch the geojson from the API
fetch('https://nominatim.openstreetmap.org/lookup?osm_ids=R3722233&format=jsonv2&polygon_geojson=1')
    .then(response => response.json())
    .then(data => {
        var geojson = data[0].geojson; // Extract geojson
        L.geoJSON(geojson).addTo(map); // Add to map
    });


// Add a green marker for Bauchi with a popup
L.marker([10.31, 9.84]).addTo(map)
    .bindPopup('Bauchi State')
    .openPopup()
    // close the popup after 4 seconds
    .on('click', function() {
        map.closePopup();

    })
    
    
    ;
var hospitalcount = 0;

// smaller markers for 'amenity': 'hospital'
fetch("https://overpass-api.de/api/interpreter?data=[out:json];area['name'='Bauchi']->.searchArea;(node['amenity'='hospital'](area.searchArea);way['amenity'='hospital'](area.searchArea);relation['amenity'='hospital'](area.searchArea););out%20body;>;out%20skel%20qt;")
    .then(response => response.json())
    .then(data => {
        count = data.elements.length;
        exactcount = 0;
        data.elements.forEach(element => {
            
            // if (!element.tags) {
            //     return;
            // }
            if (element.type !== 'node') {
                return;
            }
            exactcount++;

            
            var lat = element.lat || element.center.lat;
            var lon = element.lon || element.center.lon;
            // small circle for 'amenity': 'hospital'
            hospitalcount++;
            try { 
                document.getElementById('cnt').innerText = hospitalcount;
            }
            catch (e) {
                console.log(e);
            }
            // 'hospital', 'health_centre', 'dispensary', 'N/A'
            if (element.tags['health_facility:type'] === 'hospital') {
                L.circle([lat, lon], {
                    color: 'green',
                    fillColor: '#0f3',
                    fillOpacity: 0.5,
                    radius: 5000
                }).addTo(map)
                .on('click', function() {
                    showHospitalInfo(element.tags);
                    // alert('You clicked the hospital!');
                })
                ;
            }
            else if (element.tags['health_facility:type'] === 'health_centre') {
                L.circle([lat, lon], {
                    color: 'blue',
                    fillColor: '#03f',
                    fillOpacity: 0.5,
                    radius: 2000
                }).addTo(map)
                .on('click', function() {
                    showHospitalInfo(element.tags);
                    // alert('You clicked the health centre!');
                })
                ;
            }
            else if (element.tags['health_facility:type'] === 'dispensary') {
                L.circle([lat, lon], {
                    color: 'yellow',
                    fillColor: '#ff3',
                    fillOpacity: 0.5,
                    radius: 1000
                }).addTo(map)
                .on('click', function() {
                    showHospitalInfo(element.tags);
                    // alert('You clicked the dispensary!');
                });     
            }
            else {
                L.circle([lat, lon], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 500
                }).addTo(map)
                .on('click', function() {
                    showHospitalInfo(element.tags);
                    // alert('You clicked the other!');
                });
            }
            
            
    });
    console.log('Total: ' + count + ' Exact: ' + exactcount);
});
// add a legend
var legend = L.control({position: 'bottomright'});
legend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend');
    div.style.backgroundColor = 'white';
    div.style.padding = '10px';
    div.innerHTML += '<h4>Health Facilities</h4>';
    div.innerHTML += '<i class="fa fa-circle" style="color: #0f3">   </i><span>Hospital</span><br>';
    div.innerHTML += '<i class="fa fa-circle" style="color: #03f"></i><span>Health Centre</span><br>';
    div.innerHTML += '<i class="fa fa-circle" style="color: #ff3"></i><span>Dispensary</span><br>';
    div.innerHTML += '<i class="fa fa-circle" style="color: #f03"></i><span>Other</span><br>';
    div.innerHTML += '<br>';
    div.innerHTML += '<h4>Number of Hospitals: <span id="cnt">' + hospitalcount + '</span></h4>';
    return div;
};
legend.addTo(map);

// add a scale bar
L.control.scale().addTo(map);

setTimeout(function() {
            map.closePopup();
        }, 4000);
</script>

<script>
    // function on click popup show infomation about the hospital as on modal bootstrap
    function showHospitalInfo(info) {
    // console.log(info);
    document.getElementById('name').innerText = info.name || 'N/A';
    document.getElementById('health_facility_type').innerText = info['health_facility:type'] || 'N/A';
    document.getElementById('operator').innerText = info.operator || 'N/A';
    document.getElementById('phone').innerText = info.phone || 'N/A';
    document.getElementById('website').innerText = info.website || 'N/A';
    document.getElementById('opening_hours').innerText = info.opening_hours || 'N/A';
    document.getElementById('address').innerText = info.address || 'N/A';
    document.getElementById('wheelchair').innerText = info.wheelchair || 'N/A';
    $('#addModal').modal('show');
    }

</script>


</body>
</html>
